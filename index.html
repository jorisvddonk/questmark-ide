<html>
  <head>
    <style>
      .container {
        width: 100%;
        height: 100%;
      }

      html,
      body {
        margin: 0px;
      }

      .container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr 0.5fr;
        gap: 0px 0px;
        grid-auto-flow: row;
        grid-template-areas:
          "editor editor playground"
          "editor editor playground"
          "editor editor debug"
          "toolbox toolbox debug";
      }

      .editor {
        grid-area: editor;
      }

      .playground {
        grid-area: playground;
        background: #cfc;
      }

      .debug {
        grid-area: debug;
        background: #ccf;
      }

      .toolbox {
        grid-area: toolbox;
        background: #fcc;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"
    ></script>
    <script src="https://unpkg.com/questmark-yarn@0.0.6/dist/browser/parser.js"></script>
    <script>
      require.config({
        paths: {
          vs: "https://unpkg.com/monaco-editor@latest/min/vs"
        },
      });

      window.MonacoEnvironment = {
        getWorkerUrl: function (workerId, label) {
          return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
            self.MonacoEnvironment = {
              baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'
            };
            importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');`)}`;
        },
      };

      require(["vs/editor/editor.main"], function (a) {
        const editorInstance = monaco.editor.create(
          document.querySelector(".editor"),
          {
            value: `title: Start
---
Test
<<set $foo to false>>
<<if $foo>>
    Foo is true!
<<else>>
    Foo is false!
<<endif>>
===`,
            language: "yarn",
            theme: "vs-dark",
          }
        );

        document
          .querySelector("#compile-yarn")
          .addEventListener("click", () => {
            const vmState = QuestmarkYarn.parse(editorInstance.getValue());
            console.log(vmState);
          });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div class="editor"></div>
      <div class="playground"></div>
      <div class="debug"></div>
      <div class="toolbox">
        <button id="compile-yarn">Compile (yarn -> tzo/questvm)</button>
      </div>
    </div>
  </body>
</html>
